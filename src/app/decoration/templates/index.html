<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">
	<title>Nepheli Human Resources</title>
	 {% include 'forbidden/default_styles.html' %}  

</head>

<body id="page-top">

	<!-- Page Wrapper -->
	<div id="wrapper">
		<!-- Sidebar -->
		{% include 'forbidden/sidebar.html' %}
		<!-- End of Sidebar -->
		<!-- Content Wrapper -->
		<div id="content-wrapper" class="d-flex flex-column">
			<!-- Main Content -->
			<div id="content">
				<!-- Topbar -->
				 {% include 'forbidden/topbar.html' %}
				<!-- End of Topbar -->
				<!-- Begin Page Content -->
				<div class="container-fluid">
					<!-- Page Heading -->
					<h1 class="h3 mb-2 text-gray-800">Dashboard CVs</h1>
					<p class="mb-4"></p>
					<div class="row">
						<div class="col-xl-10 col-lg-9">
							<!-- DataTales Example -->
							<div class="card shadow mb-4">
								<div class="card-header py-3">
									<a href="/#" class="btn btn-success btn-icon-split" data-toggle="modal" data-target="#employeesModal">
											<span class="icon text-white-50">
												<i class="fas fa-plus"></i>
											</span>
											<span class="text">Add</span>
									</a>
								</div>
									<!-- [START] TABLE DEFAULT -->
										{#  {% from 'forbidden/system/init_query_macro.html' import init_query with context %} #}
										{#  {{ init_query(['Get All Departments', 'Get All Positions']) }} <!-- YOU CAN AVOID LIST FOR A SINGLE QUERY: init_query('test') --> #}
										{% set Hotels = payload['DB']['Results']["Get All Hotels"] %}
										{% set Positions = payload['DB']['Results']["Get All Positions"] %}
										{% set Employee = payload['DB']['Results']["Get All Employees"] %}
										{% set new_columns = ["Hotel", "Position", "Department", "Uploads", "Εργάνη", "Delete"] %}
										{% set col_list = ["First Name", "Last Name"]|merge_list(new_columns) %}
											<div class="card-body">
													<div class="table-responsive">
														<table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
															<thead>
																<tr>
																	{% for i in col_list %}
																		<th>{{i}}</th>
																	{% endfor %}
																</tr>
															</thead>
																<tfoot>
																	<tr>
																		{% for i in col_list %}
																			<th>{{i}}</th>
																		{% endfor %}
																	</tr>
																</tfoot>
															<tbody>
																{% for rec in Employee %}
																	{% set enum = loop.index - 1 %}
																	<tr>
																		{% if rec['Employment_Data'] is not none and "Εργάνη" in rec['Employment_Data'] %}
																			{% set ergani = rec['Employment_Data'] | to_json %}
																			{% set ergani = ergani['Εργάνη'] %}
																			{% set ergani_highlight = 'green' %}
																			{% set ergani_font = '#000' %}
																		{% else %}
																			{% set ergani = none %}
																		{% endif %}
																		{% for iii in col_list %}
																				{% if iii not in (new_columns) %}
																					<td bgcolor="{{ergani_highlight}}"><a style="color:{{ergani_font}};" href="/one_employee?employee_ID={{rec['ID']}}" target="_blank"> {{ rec[iii] }} </a></td>
																				{% else %}
																					{% if iii == "Uploads"%}
																						<td bgcolor="{{ergani_highlight}}">
																							{% set UPLOADS = rec[iii]|dict2q('2dict') %}
																							{% if UPLOADS is iterable and (UPLOADS is not string) %}
																								{% for item in UPLOADS %}
																									<a style="color:{{ergani_font}};" href="/file_download?uuid='{{rec['unique_id']}}'&file='{{item}}'" target="_blank"> {{ item }}</a>
																									</br>
																								{% endfor %}
																							{% endif %}
																						</td>
																					{% elif iii == "Εργάνη" %}
																						{% if ergani is not none %}
																							<td bgcolor="{{ergani_highlight}}" style="color:{{ergani_font}};">{{ergani}}</td>
																						{% else %}
																							<td>ΑΚΑΤΑΧΩΡΗΤΟΣ</td>
																						{% endif %}
																					{% elif iii == "Delete" %}
																						<td>
																							<form id="Delete_Employee_{{rec['ID']}}" method="post" name="Database Query" action="/index">
																								<input type="hidden" name="query_names" value="Delete Employee">
																								<input type="hidden" name="employee_ID" value="{{rec['ID']}}"/>
																								<button type="Submit" class="btn btn-danger">Delete - {{rec['ID']}}</button>
																							</form>
																						</td>
																					{% else %}
																						{% set meta = Employee[enum]['metadata']|dict2q('2dict') %}
																						{% set key =  meta['Request'] %}
																						<td bgcolor="{{ergani_highlight}}"> <a style="color:{{ergani_font}};" href="/one_employee?employee_ID={{rec['ID']}}" target="_blank"> {{ key[iii] }}</a> </td>
																					{% endif %}
																				{% endif %}
																		{% endfor %}
																	</tr>
																{% endfor %}
															</tbody>
														</table>
													</div>
											</div>
										<!-- [END] TABLE DEFAULT -->
								
							</div>
						</div>
						<div class="col-xl-2 col-lg-3">
							<div class="card shadow mb-4">
								<!-- Card Header - Dropdown -->
								<div class="card-header py-3">
									<h6 class="m-0 font-weight-bold text-primary">Department Chart</h6>
								</div>
								<!-- Card Body -->
								<div class="card-body">
									<div class="chart-pie pt-4">
										<canvas id="myPieChart"></canvas>
									</div>
									<hr>
								 In the above chart you can see the department that have more employes.
								</div>
							</div>
						</div>
					</div>

				</div>
				<!-- /.container-fluid -->

			</div>
			<!-- End of Main Content -->

			<!-- Footer -->
			<footer class="sticky-footer bg-white">
				<div class="container my-auto">
					<div class="copyright text-center my-auto">
						<span>Copyright &copy;Nepheli H.R</span>
					</div>
				</div>
			</footer>
			<!-- End of Footer -->

		</div>
		<!-- End of Content Wrapper -->

	</div>
	<!-- End of Page Wrapper -->

	<!-- Scroll to Top Button-->
	<a class="scroll-to-top rounded" href="/#page-top">
		<i class="fas fa-angle-up"></i>
	</a>

	<!-- Logout Modal-->


	<!-- Employees Modal-->
	{% include 'forbidden/employees_modal.html' %}

	<!-- Bootstrap core JavaScript-->
	<script src="{{url_for('static', path='vendor/jquery/jquery.min.js') }}"></script>
	<script src="{{url_for('static', path='vendor/bootstrap/js/bootstrap.bundle.min.js') }}"></script>

	<!-- Core plugin JavaScript-->
	<script src="{{url_for('static', path='vendor/jquery-easing/jquery.easing.min.js') }}"></script>

	<!-- Custom scripts for all pages-->
	<script src="{{url_for('static', path='js/sb-admin-2.min.js') }}"></script>

	<!-- Page level plugins -->
	<script src="{{url_for('static', path='vendor/datatables/jquery.dataTables.min.js') }}"></script>
	<script src="{{url_for('static', path='vendor/datatables/dataTables.bootstrap4.min.js') }}"></script>
	<script src="{{url_for('static', path='vendor/chart.js/Chart.min.js') }}"></script>

	<!-- Page level custom scripts -->

	<script src="{{url_for('static', path='js/demo/datatables-demo.js') }}"></script>
	<script src="{{url_for('static', path='js/demo/chart-pie-demo.js') }}"></script>
	
	<!-- Select2 script  -->
	<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

	<script type="text/javascript">
		$(document).ready(function() {
				$('#jsgender').select2();
		});
	</script>
	<script type="text/javascript">
		$(document).ready(function() {
				$('#jsposition').select2();
		});
	</script>
	<script type="text/javascript">
		$(document).ready(function() {
				$('#jsdepartment').select2();
		});
	</script>
	<script type="text/javascript">
		$(document).ready(function() {
				$('#jshotel').select2();
		});
	</script>
</body>

</html>